# 十六进制状态表示

## 状态表示示例

假如有个状态变量，具有`初始状态`、   `中间状态`以及`最终状态`三种，而每种状态各自具有两个细分内部状态，这三种大的状态可以称为`状态组`。采用十六进制定义这6种状态:

```go
const (
    STATUS_1 = 0x0001 // 初始状态1
    STATUS_2 = 0x0002 // 初始状态2
    STATUS_3 = 0x0004 // 中间状态1
    STATUS_4 = 0x0008 // 中间状态2
    STATUS_5 = 0x0010 // 最终状态1
    STATUS_6 = 0x0020 // 最终状态2
)
```

### 添加状态

当需要**添加某个状态时，使用或运算|**:

```go
// 状态组:当需要添加状态时，使用或运算|
const (
    INIT_STATUS   = STATUS_1 | STATUS_2 // 初始状态
    MIDDLE_STATUS = STATUS_3 | STATUS_4 // 中间状态
    FINAL_STATUS  = STATUS_5 | STATUS_6 // 最终状态
)
```

### 包含状态

当需要**判断是否包含某种状态时使用与运算&,结果为0则代表不包含指定状态**

```go
// 当需要判断是否包含某种状态时使用与运算&,结果为0则代表不包含指定状态
const (
    CONTAINS_STATUS_1 = (INIT_STATUS&STATUS_1 != 0)
    CONTAINS_STATUS_3 = (INIT_STATUS&STATUS_3 != 0)
)
```

```go
func main() {
	fmt.Println("初始状态包含状态1:", CONTAINS_STATUS_1)
	fmt.Println("初始状态包含状态3:", CONTAINS_STATUS_3)
}
// 初始状态包含状态1: true
// 初始状态包含状态3: false
```

### 排除状态

当需要**排除状态时，使用与运算和取反运算&^**

```go
// 当需要排除状态时，使用与运算、取反运算&^(注意取反操作在go中为^，其他语言通常为~)
const (
	INIT_STATUS_1   = INIT_STATUS & ^STATUS_2   // == STATUS_1
	MIDDLE_STATUS_3 = MIDDLE_STATUS & ^STATUS_4 // == STATUS_3
	FINAL_STATUS_5  = FINAL_STATUS & ^STATUS_6  // == STATUS_5
)
```

```go
func main() {
	fmt.Println(
		INIT_STATUS_1 == STATUS_1, // 排除2后等于1
		MIDDLE_STATUS_3 == STATUS_3, // 排除4后等于3
		FINAL_STATUS_5 == STATUS_5, // 排除6后等于5
	)
}
// true true true
```

## 状态表示的原理

其实状态的进制表示，不一定非要使用十六进制，二进制、八进制、十进制任何一种进制都可以。本质上，是要满足：在进行与或操作时，各种状态值要严格不同。比如下述两个二进制数:

```js
0001
0011
```

不能表示两种不同的状态值。因为`0011`包含了`0001`。要让状态表示严格不同，则应该让每一个二进制位独占1：

```js
0001 = 2^0 = 1 
0010 = 2^1 = 2
0100 = 2^2 = 4
1000 = 2^3 = 8
```

如果采用十进制表示状态，那么取值应该为$2^0, 2^1,2^2,2^3,...,2^n$

在代码编写上，一方面为了便于表示，另一方面需要与通常的十进制数字计算加以区分，实践中往往采用十六进制进行表示(左边为十六进制，右边为二进制、十进制):

```js
0x0001 = 0000000000000001 = 2^0 = 1
0x0002 = 0000000000000010 = 2^1 = 2
0x0004 = 0000000000000100 = 2^2 = 4
0x0008 = 0000000000001000 = 2^3 = 8
0x0010 = 0000000000010000 = 2^4 = 16
0x0020 = 0000000000100000 = 2^5 = 32
......
```

在代码中以`0x`开头就可以表示一个十六进制数，通过增加位数就可以很方便的扩大表示范围，从右往左，在每一位上依次用尽`1,2,4,8`便可往左进一位，使用起来，非常方便。

**添加状态**

```js
0x0001 | 0x0002:

0000000000000001
0000000000000010
————————————————
0000000000000011
=0x0003
```

**包含状态**

```js
0x0003 & 0x0001:

0000000000000011
0000000000000001
————————————————
0000000000000001 
=0x0001!=0
```

**排除状态**

```js
0x0003 & ^0x0001:

^0x0001=^0000000000000001=1111111111111110

0000000000000011
1111111111111110
————————————————
0000000000000010
=0x0002
```

## 状态表示的好处

采用进制表示可以提升数据库的查询效率，也可以降低存储。

- 模式管理的复杂度从 m * n 骤减至 m + n
- 模式的存储只需一个数据表字段。

# 延伸: 多标签管理

